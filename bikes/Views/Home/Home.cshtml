
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/_MainLayout.cshtml";
}

@section HEAD {
    <style type="text/css">
        .panel-body div {
            margin: 10px;
        }
        .panel-body td {
            padding-left: 10px;
        }
    </style>

    <script src="~/Content/chartjs/Chart.min.js" ></script>
    
    <script>


        $(function () {

            var addBarLegend = function (data, selector) {
                var i, j;
                var div;

                div = $(selector);

                data.datasets.forEach(function (dataset) {
                    $("<span class='label label-default'></span>")
                    .appendTo(div)
                    .html(dataset.label)
                    .css("background-color", dataset.fillColor)
                    .css("display", "inline-block")
                    .css("margin-right", "5px");
                });

            };

            var addTableCells = function (data, selector) {
                var i,j;
                var tr,tbody;

                tbody = $(selector);

                for (i = 0; i < data.length; i++) {
                    tr = $("<tr></tr>").appendTo(tbody);
                    //name
                    $("<td></td>")
                        .html(data[i].rider)
                        .appendTo(tr);
                    //mileage this month
                    $("<td class='text-right'></td>")
                        .html(data[i].monthDistance)
                        .appendTo(tr);
                    //mileage for year
                    $("<td class='text-right'></td>")
                        .html(data[i].yearDistance)
                        .appendTo(tr);
                    //amount earned
                    $("<td class='text-right'></td>")
                        .html(data[i].cashUnpaid)
                        .appendTo(tr);
                    //amount earned
                    $("<td class='text-right'></td>")
                        .html(data[i].cashYear)
                        .appendTo(tr);
                }
            };

            $.get(
                "/api/RiderSummary",
                function (data) {

                    if (data.labels.length == 0) {
                        //draw a placeholder message
                        $("#barRiderDistance").css("display", "none");
                        $("#barRiderDistancePlaceholder").css("display", "block");
                    } else {
                        var ctx = $("#barRiderDistance").get(0).getContext("2d");
                        new Chart(ctx).Bar(data, { responsive: true, maintainAspectRatio: false });
                    }
                },
                "json");

            $.get(
                "/api/YearSummary",
                function (data) {
                    var options = {
                        responsive: true,
                        maintainAspectRatio: false,
                        multiTooltipTemplate: "<%=datasetLabel%> <%=value%>"
                    };
                    var ctx = $("#barYearSummary").get(0).getContext("2d");
                    new Chart(ctx).Bar(data.chartData, options);

                    addBarLegend(data.chartData, "#barLegend");

                    addTableCells(data.riderSummary, "#riderSummaryRows");

                },
                "json");

        });
    </script>
}

<div class="row">

    <div class="col-sm-6">

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Mileage this month</h3>
            </div>
            <div class="panel-body">
                <div>
                    <canvas id="barRiderDistance" style="width:100%;height:400px;"></canvas>
                    <div id="barRiderDistancePlaceholder" style="display:none;">
                        No rides to display
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-sm-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Summary</h3>
            </div>
            <div class="panel-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th class="text-right">month</th>
                            <th class="text-right">year</th>
                            <th class="text-right">unpaid</th>
                            <th class="text-right">total</th>
                        </tr>
                    </thead>
                    <tbody id="riderSummaryRows"></tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div class="row">
    <div class="col-sm-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Year summary</h3>
            </div>
            <div class="panel-body">
                <div>
                    <canvas id="barYearSummary" style="width:100%;height:400px;"></canvas>
                </div>
                <div id="barLegend"></div>
            </div>
        </div>
    </div>
</div>

